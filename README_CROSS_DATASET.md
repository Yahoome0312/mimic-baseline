# è·¨æ•°æ®é›†æµ‹è¯•åŠŸèƒ½æ€»ç»“

## âœ… åŠŸèƒ½å·²å®ç°

ç°åœ¨é¡¹ç›®æ”¯æŒï¼š
1. **è®­ç»ƒ**: MIMIC-CXR æ•°æ®é›† (377,095 å¼ å›¾åƒ)
2. **æµ‹è¯•**: ChestXray14 æ•°æ®é›† (25,596 å¼ æµ‹è¯•å›¾åƒ)
3. **Zero-shot æ¨ç†**: æ— éœ€æ ‡ç­¾æ˜ å°„ï¼Œè‡ªåŠ¨é€‚é…

---

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. æ•°æ®åŠ è½½å™¨
- **`datasets/chestxray14_dataset.py`**
  - ChestXray14Dataset ç±»
  - ChestXray14DataLoader ç±»
  - æ”¯æŒ 14 ä¸ªç—…ç†ç±»åˆ«
  - è‡ªåŠ¨å¤„ç†å¤šæ ‡ç­¾æ•°æ®

### 2. æµ‹è¯•è„šæœ¬
- **`test_chestxray14_data.py`**
  - éªŒè¯ ChestXray14 æ•°æ®åŠ è½½
  - æ˜¾ç¤ºæ•°æ®é›†ç»Ÿè®¡ä¿¡æ¯
  - æ£€æŸ¥å›¾åƒè·¯å¾„æœ‰æ•ˆæ€§

### 3. æ‰¹å¤„ç†è„šæœ¬
- **`run_cross_dataset_test.bat`**
  - ä¸€é”®è¿è¡Œè·¨æ•°æ®é›†è®­ç»ƒå’Œæµ‹è¯•
  - è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹

### 4. æ–‡æ¡£
- **`CROSS_DATASET_GUIDE.md`**
  - å®Œæ•´ä½¿ç”¨æŒ‡å—
  - å®éªŒè®¾è®¡å»ºè®®
  - æ•…éšœæ’æŸ¥æ–¹æ¡ˆ

- **`README_CROSS_DATASET.md`** (æœ¬æ–‡ä»¶)
  - åŠŸèƒ½æ€»ç»“
  - å¿«é€Ÿå¼€å§‹æŒ‡å—

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Step 1: æµ‹è¯• ChestXray14 æ•°æ®åŠ è½½

```bash
python test_chestxray14_data.py
```

**é¢„æœŸè¾“å‡º**:
```
[OK] Data loaded successfully!
  Total test images: 25596
  Label shape: (25596, 14)
```

### Step 2: è·¨æ•°æ®é›†è®­ç»ƒå’Œæµ‹è¯•

**é€‰é¡¹ A - ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬**:
```bash
run_cross_dataset_test.bat
```

**é€‰é¡¹ B - å‘½ä»¤è¡Œ**:
```bash
# åœ¨ MIMIC è®­ç»ƒï¼Œåœ¨ ChestXray14 æµ‹è¯•
python main.py --method finetune --test_chestxray14
```

**é€‰é¡¹ C - Zero-shotï¼ˆæ— éœ€è®­ç»ƒï¼‰**:
```bash
# ç›´æ¥åœ¨ ChestXray14 è¿›è¡Œ zero-shot æµ‹è¯•
python main.py --method zeroshot --test_chestxray14
```

---

## ğŸ“Š æ•°æ®é›†å¯¹æ¯”

| ç‰¹æ€§ | MIMIC-CXR | ChestXray14 |
|------|-----------|-------------|
| **ç”¨é€”** | è®­ç»ƒ + éªŒè¯ | æµ‹è¯• |
| **å›¾åƒæ•°** | 377,095 | 25,596 (æµ‹è¯•é›†) |
| **ç±»åˆ«æ•°** | 14 | 14 |
| **æ¥æº** | è´æ–¯ä»¥è‰²åˆ—åŒ»é™¢ | NIH |
| **æ ‡æ³¨è´¨é‡** | é«˜ï¼ˆæ”¾å°„ç§‘æŠ¥å‘Šï¼‰ | ä¸­ï¼ˆNLPæå–ï¼‰ |

---

## ğŸ¯ ä¸»è¦æ”¹åŠ¨

### 1. æ–°å¢å‘½ä»¤è¡Œå‚æ•°

```bash
--test_chestxray14          # ä½¿ç”¨å¤–éƒ¨æµ‹è¯•é›†
--test_chestxray14_path     # æŒ‡å®šå¤–éƒ¨æ•°æ®é›†è·¯å¾„ï¼ˆå¯é€‰ï¼‰
```

### 2. è‡ªåŠ¨æ–‡ä»¶å‘½å

**MIMIC æµ‹è¯•é›†**:
- `zeroshot_results.json`
- `finetune_results.json`

**ChestXray14 æµ‹è¯•é›†**:
- `zeroshot_on_ChestXray14_results.json`
- `finetune_on_ChestXray14_results.json`

### 3. Zero-shot æ–‡æœ¬æç¤º

è‡ªåŠ¨ä¸º ChestXray14 ç±»åˆ«ç”Ÿæˆåˆé€‚çš„æ–‡æœ¬æç¤ºï¼š
```
"chest x-ray showing atelectasis"
"chest x-ray showing cardiomegaly"
"chest x-ray showing infiltration"
...
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: åŸºçº¿æ€§èƒ½è¯„ä¼°
```bash
# åœ¨ MIMIC ä¸Šè®­ç»ƒå’Œæµ‹è¯•ï¼ˆåŒåˆ†å¸ƒï¼‰
python main.py --method finetune
```

### åœºæ™¯ 2: æ³›åŒ–èƒ½åŠ›æµ‹è¯•
```bash
# åœ¨ MIMIC è®­ç»ƒï¼Œåœ¨ ChestXray14 æµ‹è¯•ï¼ˆè·¨åˆ†å¸ƒï¼‰
python main.py --method finetune --test_chestxray14
```

### åœºæ™¯ 3: Zero-shot èƒ½åŠ›è¯„ä¼°
```bash
# ä¸è®­ç»ƒï¼Œç›´æ¥ zero-shot æµ‹è¯• ChestXray14
python main.py --method zeroshot --test_chestxray14
```

---

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

æ ¹æ®æ–‡çŒ®å’Œç»éªŒï¼š

### MIMIC æµ‹è¯•é›†ï¼ˆåŒåˆ†å¸ƒï¼‰
- **Subset Accuracy**: 25-35%
- **Hamming Loss**: 0.05-0.10
- **F1-score (Macro)**: 0.60-0.75
- **AUC (Macro)**: 0.75-0.85

### ChestXray14 æµ‹è¯•é›†ï¼ˆè·¨åˆ†å¸ƒï¼‰
- **Subset Accuracy**: 15-25%ï¼ˆä¸‹é™ ~10%ï¼‰
- **Hamming Loss**: 0.08-0.15ï¼ˆä¸Šå‡ï¼‰
- **F1-score (Macro)**: 0.40-0.60ï¼ˆä¸‹é™ ~15-20%ï¼‰
- **AUC (Macro)**: 0.65-0.75ï¼ˆä¸‹é™ ~10%ï¼‰

**æ€§èƒ½ä¸‹é™åŸå› **:
1. æ•°æ®åˆ†å¸ƒå·®å¼‚ï¼ˆåŒ»é™¢ã€è®¾å¤‡ã€æ‚£è€…ç¾¤ä½“ï¼‰
2. æ ‡æ³¨æ–¹å¼ä¸åŒï¼ˆMIMIC ç”¨æ”¾å°„ç§‘æŠ¥å‘Šï¼ŒChestXray14 ç”¨ NLPï¼‰
3. ç±»åˆ«å®šä¹‰ç•¥æœ‰å·®å¼‚

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆä¸éœ€è¦æ ‡ç­¾æ˜ å°„ï¼Ÿ

ä¼ ç»Ÿçš„è·¨æ•°æ®é›†æ–¹æ³•éœ€è¦æ‰‹åŠ¨æ˜ å°„ç±»åˆ«ï¼Œä¾‹å¦‚ï¼š
```python
# ä¼ ç»Ÿæ–¹æ³•éœ€è¦è¿™æ ·
label_mapping = {
    'Pleural Effusion': 'Effusion',
    ...
}
```

**æˆ‘ä»¬çš„æ–¹æ³•ä½¿ç”¨ Zero-shot**:
1. ä¸ºæ¯ä¸ªç±»åˆ«ç”Ÿæˆæ–‡æœ¬æç¤º
2. ç”¨ CLIP è®¡ç®—å›¾åƒ-æ–‡æœ¬ç›¸ä¼¼åº¦
3. è‡ªåŠ¨é€‚é…ä¸åŒç±»åˆ«åç§°

```python
# MIMIC ç±»åˆ«: "Pleural Effusion"
text_prompt = "chest x-ray showing pleural effusion"

# ChestXray14 ç±»åˆ«: "Effusion"
text_prompt = "chest x-ray showing effusion"

# CLIP è‡ªåŠ¨ç†è§£ä¸¤è€…è¯­ä¹‰ç›¸åŒï¼
```

### æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MIMIC-CXR æ•°æ®é›†   â”‚
â”‚  (è®­ç»ƒ + éªŒè¯)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BiomedCLIP   â”‚
   â”‚  è®­ç»ƒ/å¾®è°ƒ    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    ä¿å­˜æœ€ä½³æ¨¡å‹
           â”‚
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â†“                 â†“
MIMIC æµ‹è¯•      ChestXray14
(åŒåˆ†å¸ƒ)        (è·¨åˆ†å¸ƒ)
  â”‚                 â”‚
  â†“                 â†“
è¯„ä¼°æŒ‡æ ‡         è¯„ä¼°æŒ‡æ ‡
```

---

## ğŸ› ï¸ è‡ªå®šä¹‰é…ç½®

### æŒ‡å®š ChestXray14 è·¯å¾„

å¦‚æœæ•°æ®ä¸åœ¨é»˜è®¤ä½ç½®ï¼š
```bash
python main.py --test_chestxray14 \
  --test_chestxray14_path "E:\MyData\ChestXray14"
```

### è°ƒæ•´è®­ç»ƒå‚æ•°

```bash
python main.py --method finetune --test_chestxray14 \
  --batch_size 16 \
  --epochs 30 \
  --lr 5e-6
```

### å®éªŒå‘½å

```bash
python main.py --method finetune --test_chestxray14 \
  --experiment_name "exp_lr5e6_v1" \
  --lr 5e-6
```

---

## ğŸ“‹ ChestXray14 ç±»åˆ«åˆ—è¡¨

å®Œæ•´çš„ 14 ä¸ªç±»åˆ«ï¼š

1. **Atelectasis** (è‚ºä¸å¼ ) - 12.81%
2. **Cardiomegaly** (å¿ƒè„è‚¥å¤§) - 4.18%
3. **Consolidation** (è‚ºå®å˜) - 7.09%
4. **Edema** (æ°´è‚¿) - 3.61%
5. **Effusion** (ç§¯æ¶²) - 18.20% â¬†ï¸
6. **Emphysema** (è‚ºæ°”è‚¿) - 4.27%
7. **Fibrosis** (çº¤ç»´åŒ–) - 1.70%
8. **Hernia** (ç–æ°”) - 0.34% â¬‡ï¸ æœ€å°‘
9. **Infiltration** (æµ¸æ¶¦) - 23.88% â¬†ï¸ æœ€å¤š
10. **Mass** (è‚¿å—) - 6.83%
11. **Nodule** (ç»“èŠ‚) - 6.34%
12. **Pleural_Thickening** (èƒ¸è†œå¢åš) - 4.47%
13. **Pneumonia** (è‚ºç‚) - 2.17%
14. **Pneumothorax** (æ°”èƒ¸) - 10.41%

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè·¨æ•°æ®é›†æ€§èƒ½ä¼šä¸‹é™ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼ŒåŸå› ï¼š
- æ•°æ®åˆ†å¸ƒå·®å¼‚ï¼ˆDomain Shiftï¼‰
- æ ‡æ³¨æ–¹å¼ä¸åŒ
- å›¾åƒé‡‡é›†è®¾å¤‡å’Œåè®®å·®å¼‚

**æ€§èƒ½ä¸‹é™å¹…åº¦åæ˜ äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›**ã€‚

### Q2: å¦‚ä½•æé«˜è·¨æ•°æ®é›†æ€§èƒ½ï¼Ÿ

**A**: å¯ä»¥å°è¯•ï¼š
1. ä½¿ç”¨ Domain Adaptation æŠ€æœ¯
2. å¢åŠ è®­ç»ƒæ•°æ®å¤šæ ·æ€§
3. ä½¿ç”¨æ›´å¼ºçš„æ•°æ®å¢å¼º
4. è°ƒæ•´è®­ç»ƒå‚æ•°ï¼ˆå­¦ä¹ ç‡ã€batch_sizeï¼‰

### Q3: èƒ½å¦åœ¨ ChestXray14 ä¸Šè®­ç»ƒï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†éœ€è¦ï¼š
1. ä¿®æ”¹ `config.py` ä¸­çš„è·¯å¾„å’Œç±»åˆ«
2. ä½¿ç”¨ `chestxray14_dataset.py` æ›¿ä»£ `mimic_dataset.py`
3. ChestXray14 æ²¡æœ‰å®˜æ–¹çš„ train/val åˆ†å‰²ï¼Œéœ€è¦è‡ªå·±åˆ’åˆ†

### Q4: ä¸¤ä¸ªæ•°æ®é›†èƒ½å¦æ··åˆè®­ç»ƒï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†éœ€è¦ï¼š
1. ç»Ÿä¸€ç±»åˆ«å®šä¹‰
2. åˆ›å»ºæ··åˆæ•°æ®åŠ è½½å™¨
3. æ³¨æ„æ ‡æ³¨è´¨é‡å·®å¼‚

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. **MIMIC-CXR**: Johnson et al., "MIMIC-CXR Database", *Scientific Data*, 2019
2. **ChestXray14**: Wang et al., "ChestX-ray8", *CVPR*, 2017
3. **BiomedCLIP**: Zhang et al., "BiomedCLIP", 2023

---

## ğŸ“ å­¦æœ¯ç”¨é€”

### å®éªŒè®¾è®¡ç¤ºä¾‹

**ç ”ç©¶é—®é¢˜**: BiomedCLIP åœ¨è·¨åŒ»é™¢èƒ¸éƒ¨Xå…‰æ•°æ®é›†ä¸Šçš„æ³›åŒ–èƒ½åŠ›

**å®éªŒè®¾ç½®**:
1. **è®­ç»ƒ**: MIMIC-CXR (æ³¢å£«é¡¿è´æ–¯ä»¥è‰²åˆ—åŒ»é™¢)
2. **æµ‹è¯•**: ChestXray14 (NIH å¤šåŒ»é™¢æ±‡æ€»)
3. **å¯¹æ¯”**: åŒåˆ†å¸ƒ vs è·¨åˆ†å¸ƒæ€§èƒ½

**è¯„ä¼°æŒ‡æ ‡**:
- AUC-ROC (per-class and macro)
- F1-score (per-class and macro)
- Subset Accuracy
- Hamming Loss

**é¢„æœŸè´¡çŒ®**:
- é‡åŒ–æ¨¡å‹æ³›åŒ–èƒ½åŠ›
- è¯†åˆ«å¯¹åˆ†å¸ƒå˜åŒ–æ•æ„Ÿçš„ç±»åˆ«
- ä¸ºä¸´åºŠéƒ¨ç½²æä¾›å‚è€ƒ

---

## âœ… éªŒè¯æ¸…å•

åœ¨è¿è¡Œè·¨æ•°æ®é›†æµ‹è¯•å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] ChestXray14 æ•°æ®å·²ä¸‹è½½åˆ° `D:\Data\ChestXray14\CXR8`
- [ ] è¿è¡Œ `test_chestxray14_data.py` æˆåŠŸ
- [ ] è‡³å°‘æœ‰ 32GB å†…å­˜ï¼ˆæˆ–è°ƒå° batch_sizeï¼‰
- [ ] CUDA GPU å¯ç”¨ï¼ˆæ¨èï¼‰
- [ ] æœ‰è¶³å¤Ÿç£ç›˜ç©ºé—´ä¿å­˜ç»“æœï¼ˆ~1GBï¼‰

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-15
**ä½œè€…**: Claude
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´ï¼Œæµ‹è¯•é€šè¿‡

è¯¦ç»†æŠ€æœ¯æ–‡æ¡£è¯·å‚è€ƒ `CROSS_DATASET_GUIDE.md`
